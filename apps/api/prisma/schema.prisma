// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URI")
}

model User {
  id      Int      @id @default(autoincrement())
  email   String   @unique //TODO: figure out how to make this mandatory for all except <=12U
  phone   String //TODO: similarly, make this include all except players...
  pass    String
  fname   String
  lname   String

  //TODO: for all the following add appropriate relations
  admin   Admin
  coach   Coach
  regCoach RegCoach
  player  Player
  fan     Fan
  primaryRole enum //TODO: primary_role enum
}

model Admin {
    id  Int @id @default(autoincrement())
}

model Fan {
    id  Int @id @default(autoincrement())
}

model Coach {
    id  Int @id @default(autoincrement())
    
    teams Team[]
    phone String //TODO: phone string constraints?
}

model RegCoach {
    id  Int  @id @default(autoincrement())

    teams Team[] //TODO: enforce region matched teams
    region enum //TODO: region enum
    phone String
}

model Team {
    id  Int @id @default(autoincrement())
    
    name String 
    ageGroup enum //TODO: age_group enum
    region enum //TODO: region enum

    headCoach Coach @relation(fields: [headCoachID], references: [id])
    headCoachID Int
    trophyCase[] Trophy
}

model Trophy {
    id  @id @default(@autoincrement())
    
    title String
    imageURL String
}

model Player {
    id  @id @default(@autoincrement())
    
    team @relation(fields: [teamID], references: [id])
    teamID Int

    pos1 enum //TODO: pos enum
    pos2 enum //TODO: pos enum
    jerseyNum string //TODO: jersey constraints
    gradYear string //TODO: grad year constraints

    jerseySize enum //TODO: jersey size enum
    pantSize enum //TODO: pant size enum
    stirrupSize enum //TODO: stirrup size enum
    shortSize enum //TODO: short size enum
    practiceShortSize enum //TODO: practice short size

    ageGroup enum //TODO: ageGroup enum

    //8-14u
    parents Parent[]

    //14u only
    isTrusted bool 

    //14u to alumn
    college enum //TODO: colleges enum & populate
    address @relation(fields: [addressID], references:id])

    addressID Int
}

model Parent {
    id  @id @default(@autoincrement())

    children Player[]

    phone String
}

model Address {
    id  @id @default(@autoincrement())

    //TODO: see if we can get location enums, if not no worries
    state enum
    city enum
    zip string // TODO: constrain string?
    address_1 string
    address_2 string
}

//NOTE: The following is only test data
model Post {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String   @db.VarChar(255)
  content   String?
  published Boolean  @default(false)
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  authorId  Int
}

model Profile {
  id     Int     @id @default(autoincrement())
  bio    String?
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int     @unique
}

model User {
  id      Int      @id @default(autoincrement())
  email   String   @unique
  name    String?
  posts   Post[]
  profile Profile?
}
